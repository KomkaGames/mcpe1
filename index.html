<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‚ú® –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –®–µ–π–¥–µ—Ä—ñ–≤ MCPE (v7 - Mobile & MCPACK)</title>
    <style>
        :root {
            --mc-blue: #2196F3;
            --mc-dark: #333;
            --mc-light: #f4f4f4;
            --mc-green: #4CAF50;
            --mc-accent: #FF9800;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--mc-light);
            color: var(--mc-dark);
            padding: 10px; /* –ó–º–µ–Ω—à–µ–Ω–∏–π –≤—ñ–¥—Å—Ç—É–ø –¥–ª—è –º–æ–±—ñ–ª—å–Ω–∏—Ö */
            margin: 0;
            line-height: 1.6;
        }
        .container {
            max-width: 1100px;
            margin: 0 auto;
            background: white;
            padding: 15px; /* –ó–º–µ–Ω—à–µ–Ω–∏–π –≤—ñ–¥—Å—Ç—É–ø */
            border-radius: 12px;
            box-shadow: 0 4px 40px rgba(0, 0, 0, 0.15);
        }
        h1 {
            text-align: center;
            color: var(--mc-blue);
            margin-bottom: 15px;
            font-size: 1.8em; /* –ê–¥–∞–ø—Ç–∞—Ü—ñ—è —Ä–æ–∑–º—ñ—Ä—É */
        }
        /* –°—Ç–∏–ª—ñ –¥–ª—è –≤–∫–ª–∞–¥–æ–∫ (Tabs) */
        .tabs {
            display: flex;
            border-bottom: 2px solid #ccc;
            margin-bottom: 10px;
            overflow-x: auto; /* –î–æ–∑–≤–æ–ª—è—î —Å–∫—Ä–æ–ª–ª –≤–∫–ª–∞–¥–æ–∫ –Ω–∞ –≤—É–∑—å–∫–∏—Ö –µ–∫—Ä–∞–Ω–∞—Ö */
        }
        .tab-button {
            padding: 8px 12px;
            white-space: nowrap; /* –ó–∞–ø–æ–±—ñ–≥–∞—î –ø–µ—Ä–µ–Ω–æ—Å—É —Ç–µ–∫—Å—Ç—É */
        }
        .tab-content {
            display: none;
            padding: 10px 0;
            flex-wrap: wrap; /* –î–æ–∑–≤–æ–ª—è—î –ø–µ—Ä–µ–Ω–æ—Å–∏—Ç–∏ –ø–∞–Ω–µ–ª—ñ –Ω–∞ –Ω–æ–≤–∏–π —Ä—è–¥–æ–∫ */
        }
        .tab-content.active {
            display: flex; 
            gap: 15px;
        }
        .controls-panel {
            flex-basis: 100%; /* –ó–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º –ø–æ–≤–Ω–∞ —à–∏—Ä–∏–Ω–∞ */
            min-width: 0;
        }
        .preview-panel {
            flex-basis: 100%; /* –ó–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º –ø–æ–≤–Ω–∞ —à–∏—Ä–∏–Ω–∞ */
            order: -1; /* –í—ñ–¥–æ–±—Ä–∞–∂–∞—Ç–∏ –ø—Ä–µ–≤'—é –≤–≥–æ—Ä—ñ –Ω–∞ –º–æ–±—ñ–ª—å–Ω–∏—Ö */
            padding-top: 10px;
        }
        .preview-panel img {
            width: 100%;
            height: auto;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        .control-group {
            margin-bottom: 10px;
            flex-direction: column;
            align-items: flex-start;
        }
        .control-group label {
            width: 100%;
            font-weight: bold;
            margin-bottom: 5px;
        }
        .control-group input[type="range"],
        .control-group input[type="color"] {
            width: 100%;
        }
        .control-group span {
            width: 100%;
            text-align: right;
            margin-top: 5px;
        }

        /* –°—Ç–∏–ª—ñ –¥–ª—è –¥–µ—Å–∫—Ç–æ–ø—É (–∫–æ–ª–∏ —à–∏—Ä–∏–Ω–∞ –±—ñ–ª—å—à–∞ –∑–∞ 768px) */
        @media (min-width: 768px) {
            .container {
                padding: 30px;
            }
            .tab-content.active {
                flex-wrap: nowrap;
            }
            .controls-panel {
                flex-basis: 55%;
                min-width: 400px;
            }
            .preview-panel {
                flex-basis: 45%;
                order: 0;
                padding-top: 20px;
            }
            .control-group {
                flex-direction: row;
                align-items: center;
            }
            .control-group label {
                flex-basis: 40%;
                margin-bottom: 0;
            }
            .control-group input[type="range"] {
                flex-grow: 1;
            }
            .control-group span {
                flex-basis: 15%;
                text-align: right;
            }
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
</head>
<body>

    <div class="container">
        <h1>‚ú® –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –®–µ–π–¥–µ—Ä—ñ–≤ MCPE (v7)</h1>
        <p>–ù–∞–ª–∞—à—Ç—É–π—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏. –§—ñ–Ω–∞–ª—å–Ω–∏–π —Ñ–∞–π–ª –±—É–¥–µ –∑–±–µ—Ä–µ–∂–µ–Ω–æ —è–∫ **.mcpack**.</p>

        <div class="tabs">
            <button class="tab-button active" onclick="openTab(event, 'water')">üåä –í–æ–¥–∞ & –ê–Ω—ñ–º–∞—Ü—ñ—è</button>
            <button class="tab-button" onclick="openTab(event, 'lighting')">üí° –û—Å–≤—ñ—Ç–ª–µ–Ω–Ω—è</button>
            <button class="tab-button" onclick="openTab(event, 'fog')">üå´Ô∏è –ê—Ç–º–æ—Å—Ñ–µ—Ä–∞</button>
            <button class="tab-button" onclick="openTab(event, 'combiner')">üîó –û–±'—î–¥–Ω–∞–Ω–Ω—è</button>
        </div>

        <div id="water" class="tab-content active">
            <div class="preview-panel">
                <img src="https://i.imgur.com/G5v7A0X.png" alt="–ü–æ–ø–µ—Ä–µ–¥–Ω—ñ–π –ø–µ—Ä–µ–≥–ª—è–¥ —à–µ–π–¥–µ—Ä—ñ–≤ Minecraft">
            </div>
            <div class="controls-panel">
                <h2 class="section-header">‚úÖ –í–∏–±—ñ—Ä–∫–æ–≤–µ –í–∫–ª—é—á–µ–Ω–Ω—è –§—É–Ω–∫—Ü—ñ–π –®–µ–π–¥–µ—Ä—ñ–≤ (–û–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—è)</h2>
                <div class="controls checkbox-group">
                    <div class="control-group">
                        <label>
                            <input type="checkbox" id="enable-water-reflection" checked onchange="updateSettings()"> 
                            **–í—ñ–¥–±–∏—Ç—Ç—è –í–æ–¥–∏ (Reflection):** –í–∏—Å–æ–∫–µ –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è.
                        </label>
                        <label>
                            <input type="checkbox" id="enable-pbr" checked onchange="updateSettings()">
                            **–ú–µ—Ç–∞–ª—ñ—á–Ω–∏–π –í—ñ–¥–±–ª–∏—Å–∫ (PBR/Specular).**
                        </label>
                    </div>
                    <div class="control-group">
                        <label>
                            <input type="checkbox" id="enable-sway-animation" checked onchange="updateSettings()">
                            **–ü–æ—Ö–∏—Ç—É–≤–∞–Ω–Ω—è –†–æ—Å–ª–∏–Ω (Sway).**
                        </label>
                        <label>
                            <input type="checkbox" id="enable-godrays" checked onchange="updateSettings()">
                            **–°–æ–Ω—è—á–Ω—ñ –ü—Ä–æ–º–µ–Ω—ñ (God Rays).**
                        </label>
                    </div>
                </div>

                <h2 class="section-header">üåä –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –í–æ–¥–∏</h2>
                <div class="controls">
                    <div class="control-group">
                        <label for="water-realism-slider">–†—ñ–≤–µ–Ω—å –†–µ–∞–ª—ñ—Å—Ç–∏—á–Ω–æ—Å—Ç—ñ (Refraction/Reflection):</label>
                        <input type="range" id="water-realism-slider" min="0" max="3" step="1" value="2" oninput="updateSettings()">
                        <span id="water-realism-value">–†—ñ–≤–µ–Ω—å 2</span>
                    </div>
                    <div class="control-group">
                        <label for="water-depth-slider">–ì–ª–∏–±–∏–Ω–∞ –í–æ–¥–∏ (–í–ø–ª–∏–≤ –Ω–∞ –∫–æ–ª—ñ—Ä):</label>
                        <input type="range" id="water-depth-slider" min="5" max="50" step="5" value="20" oninput="updateSettings()">
                        <span id="water-depth-value">20 –º</span>
                    </div>
                    <div class="control-group">
                        <label for="ripple-intensity-slider">–Ü–Ω—Ç–µ–Ω—Å–∏–≤–Ω—ñ—Å—Ç—å –•–≤–∏–ª—å–æ–≤–æ–≥–æ –ü–æ—Ö–∏—Ç—É–≤–∞–Ω–Ω—è:</label>
                        <input type="range" id="ripple-intensity-slider" min="0.0" max="1.0" step="0.1" value="0.3" oninput="updateSettings()">
                        <span id="ripple-intensity-value">0.3</span>
                    </div>
                </div>

                <h2 class="section-header">üçÉ –ê–Ω—ñ–º–∞—Ü—ñ—è –†–æ—Å–ª–∏–Ω —Ç–∞ –•–º–∞—Ä</h2>
                <div class="controls">
                     <div class="control-group">
                        <label for="grass-sway-speed-slider">–®–≤–∏–¥–∫—ñ—Å—Ç—å –ü–æ—Ö–∏—Ç—É–≤–∞–Ω–Ω—è –¢—Ä–∞–≤–∏/–õ—ñ–∞–Ω:</label>
                        <input type="range" id="grass-sway-speed-slider" min="0.5" max="3.0" step="0.5" value="1.5" oninput="updateSettings()">
                        <span id="grass-sway-speed-value">1.5x</span>
                    </div>
                    <div class="control-group">
                        <label for="leaves-sway-amp-slider">–ê–º–ø–ª—ñ—Ç—É–¥–∞ –ü–æ—Ö–∏—Ç—É–≤–∞–Ω–Ω—è –õ–∏—Å—Ç—è:</label>
                        <input type="range" id="leaves-sway-amp-slider" min="0.0" max="1.0" step="0.1" value="0.4" oninput="updateSettings()">
                        <span id="leaves-sway-amp-value">0.4</span>
                    </div>
                    <div class="control-group">
                        <label for="cloud-speed-slider">–®–≤–∏–¥–∫—ñ—Å—Ç—å –†—É—Ö—É –•–º–∞—Ä:</label>
                        <input type="range" id="cloud-speed-slider" min="0.0" max="2.0" step="0.1" value="0.8" oninput="updateSettings()">
                        <span id="cloud-speed-value">0.8x</span>
                    </div>
                </div>
            </div>
        </div>

        <div id="lighting" class="tab-content">
            <div class="preview-panel">
                 <img src="https://i.imgur.com/G5v7A0X.png" alt="–ü–æ–ø–µ—Ä–µ–¥–Ω—ñ–π –ø–µ—Ä–µ–≥–ª—è–¥ —à–µ–π–¥–µ—Ä—ñ–≤ Minecraft">
            </div>
            <div class="controls-panel">
                <h2 class="section-header">üí° –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –û—Å–≤—ñ—Ç–ª–µ–Ω–Ω—è —Ç–∞ –ú–µ—Ç–∞–ª—ñ–≤ (PBR)</h2>
                <div class="controls">
                    <div class="control-group">
                        <label for="pbr-reflectivity-slider">–Ü–Ω—Ç–µ–Ω—Å–∏–≤–Ω—ñ—Å—Ç—å –ú–µ—Ç–∞–ª—ñ—á–Ω–æ–≥–æ –í—ñ–¥–±–ª–∏—Å–∫—É:</label>
                        <input type="range" id="pbr-reflectivity-slider" min="0.0" max="1.0" step="0.1" value="0.7" oninput="updateSettings()">
                        <span id="pbr-reflectivity-value">0.7</span>
                    </div>
                    <div class="control-group">
                        <label for="sunlight-intensity-slider">–Ü–Ω—Ç–µ–Ω—Å–∏–≤–Ω—ñ—Å—Ç—å –°–æ–Ω—è—á–Ω–æ–≥–æ –°–≤—ñ—Ç–ª–∞:</label>
                        <input type="range" id="sunlight-intensity-slider" min="0.5" max="2.0" step="0.1" value="1.0" oninput="updateSettings()">
                        <span id="sunlight-intensity-value">1.0x</span>
                    </div>
                    <div class="control-group">
                        <label for="moonlight-intensity-slider">–Ü–Ω—Ç–µ–Ω—Å–∏–≤–Ω—ñ—Å—Ç—å –ù—ñ—á–Ω–æ–≥–æ –°–≤—ñ—Ç–ª–∞ (–ú—ñ—Å—è—Ü—å):</label>
                        <input type="range" id="moonlight-intensity-slider" min="0.0" max="1.0" step="0.1" value="0.2" oninput="updateSettings()">
                        <span id="moonlight-intensity-value">0.2x</span>
                    </div>
                    <div class="control-group">
                        <label for="light-source-radius-slider">–†–∞–¥—ñ—É—Å –°–≤—ñ—Ç–ª–∞ –≤—ñ–¥ –ë–ª–æ–∫—ñ–≤ (–°–º–æ–ª–æ—Å–∫–∏–ø–∏/–õ–∞–≤–∞):</label>
                        <input type="range" id="light-source-radius-slider" min="0.5" max="5.0" step="0.5" value="2.0" oninput="updateSettings()">
                        <span id="light-source-radius-value">2.0</span>
                    </div>
                </div>
            </div>
        </div>

        <div id="fog" class="tab-content">
            <div class="preview-panel">
                 <img src="https://i.imgur.com/G5v7A0X.png" alt="–ü–æ–ø–µ—Ä–µ–¥–Ω—ñ–π –ø–µ—Ä–µ–≥–ª—è–¥ —à–µ–π–¥–µ—Ä—ñ–≤ Minecraft">
            </div>
            <div class="controls-panel">
                <h2 class="section-header">üå´Ô∏è –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –¢—É–º–∞–Ω—É —Ç–∞ –ì–ª–æ–±–∞–ª—å–Ω–∏—Ö –ï—Ñ–µ–∫—Ç—ñ–≤</h2>
                <div class="controls">
                    <div class="control-group">
                        <label for="fog-density-slider">–©—ñ–ª—å–Ω—ñ—Å—Ç—å –¢—É–º–∞–Ω—É (Fog Density):</label>
                        <input type="range" id="fog-density-slider" min="0.0" max="1.0" step="0.1" value="0.2" oninput="updateSettings()">
                        <span id="fog-density-value">0.2</span>
                    </div>
                    <div class="control-group">
                        <label for="fog-color-picker">–ö–æ–ª—ñ—Ä –¢—É–º–∞–Ω—É:</label>
                        <input type="color" id="fog-color-picker" value="#A0B9C9" oninput="updateSettings()">
                        <span id="fog-color-value">#A0B9C9</span>
                    </div>
                    <div class="control-group">
                        <label for="sky-color-picker">–ö–æ–ª—ñ—Ä –ù–µ–±–∞ (Ambient Sky Color):</label>
                        <input type="color" id="sky-color-picker" value="#66AADD" oninput="updateSettings()">
                        <span id="sky-color-value">#66AADD</span>
                    </div>
                    <div class="control-group">
                        <label for="saturation-slider">–ó–∞–≥–∞–ª—å–Ω–∞ –ù–∞—Å–∏—á–µ–Ω—ñ—Å—Ç—å –ö–æ–ª—å–æ—Ä—ñ–≤:</label>
                        <input type="range" id="saturation-slider" min="0.0" max="2.0" step="0.1" value="1.0" oninput="updateSettings()">
                        <span id="saturation-value">1.0x</span>
                    </div>
                </div>
            </div>
        </div>
        
        <div id="combiner" class="tab-content">
            <div class="controls-panel" style="flex-basis: 100%;">
                <h2 class="section-header">üîó –û–±'—î–¥–Ω–∞–Ω–Ω—è —Ç–∞ –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è</h2>
                <p>–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å –∫–Ω–æ–ø–∫—É, —â–æ–± —Å—Ç–≤–æ—Ä–∏—Ç–∏ —Ñ—ñ–Ω–∞–ª—å–Ω–∏–π –ø–∞–∫–µ—Ç. –§–∞–π–ª –±—É–¥–µ –∑–±–µ—Ä–µ–∂–µ–Ω–æ —è–∫ **.mcpack**, –≥–æ—Ç–æ–≤–∏–π –¥–ª—è —ñ–º–ø–æ—Ä—Ç—É –≤ Minecraft Bedrock Edition (MCPE).</p>

                <ul id="config-list">
                    <li>–í–æ–¥–∞ & –ê–Ω—ñ–º–∞—Ü—ñ—è (Shaders): <span id="water-status" class="status-ready">–ó–±–µ—Ä–µ–∂–µ–Ω–æ</span></li>
                    <li>–û—Å–≤—ñ—Ç–ª–µ–Ω–Ω—è (Shaders): <span id="lighting-status" class="status-ready">–ó–±–µ—Ä–µ–∂–µ–Ω–æ</span></li>
                    <li>–¢—É–º–∞–Ω (Shaders): <span id="fog-status" class="status-ready">–ó–±–µ—Ä–µ–∂–µ–Ω–æ</span></li>
                </ul>

                <button class="download-btn" onclick="combineAndDownloadPack()">
                    ‚úÖ –°–¢–í–û–†–ò–¢–ò MASTER SHADER PACK (.mcpack)
                </button>
                <p id="status-message" style="text-align: center; margin-top: 15px;"></p>
            </div>
        </div>

    </div>

    <script>
        // –ì–õ–û–ë–ê–õ–¨–ù–ò–ô –û–ë'–Ñ–ö–¢, –©–û –ó–ë–ï–†–Ü–ì–ê–Ñ –í–°–Ü –ù–ê–õ–ê–®–¢–£–í–ê–ù–ù–Ø
        let currentSettings = {};

        // –ú–∞–ø—É–≤–∞–Ω–Ω—è ID –µ–ª–µ–º–µ–Ω—Ç—ñ–≤ –Ω–∞ –∫–ª—é—á—ñ –æ–±'—î–∫—Ç–∞
        const UI_MAP = {
            'enable-water-reflection': 'bool', 'enable-pbr': 'bool', 'enable-sway-animation': 'bool', 'enable-godrays': 'bool',
            'water-realism-slider': '–†—ñ–≤–µ–Ω—å {value}', 'water-depth-slider': '{value} –º', 'ripple-intensity-slider': '{value}', 
            'grass-sway-speed-slider': '{value}x', 'leaves-sway-amp-slider': '{value}', 'cloud-speed-slider': '{value}x', 
            'pbr-reflectivity-slider': '{value}', 'sunlight-intensity-slider': '{value}x', 'moonlight-intensity-slider': '{value}x', 'light-source-radius-slider': '{value}', 
            'fog-density-slider': '{value}', 'fog-color-picker': '{value}', 'sky-color-picker': '{value}', 'saturation-slider': '{value}x',
        };
        
        // --- –£—Ç–∏–ª—ñ—Ç–∏ —Ç–∞ –ö–æ–ª—å–æ—Ä–æ–≤—ñ –ü–µ—Ä–µ—Ç–≤–æ—Ä–µ–Ω–Ω—è ---

        function generateUUID() {
            if (window.crypto && window.crypto.randomUUID) return window.crypto.randomUUID();
            return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
                const r = Math.random() * 16 | 0;
                const v = c === 'x' ? r : (r & 0x3 | 0x8);
                return v.toString(16);
            });
        }
        
        function hexToRgbArray(hex) {
            // –í–∏–ø—Ä–∞–≤–ª–µ–Ω–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞, —â–æ–± —É–Ω–∏–∫–Ω—É—Ç–∏ –ø–æ–º–∏–ª–æ–∫ —ñ –ø–æ–ø–µ—Ä–µ–¥–∂–µ–Ω—å
            if (!hex || typeof hex !== 'string' || hex.length < 7) {
                // –í–∏–¥–∞–ª–µ–Ω–æ console.error, –æ—Å–∫—ñ–ª—å–∫–∏ —Ü–µ –ª–∏—à–µ –¥—ñ–∞–≥–Ω–æ—Å—Ç–∏—á–Ω–µ –ø–æ–ø–µ—Ä–µ–¥–∂–µ–Ω–Ω—è
                return [0, 0, 0]; 
            }
            const bigint = parseInt(hex.substring(1), 16);
            const r = (bigint >> 16) & 255;
            const g = (bigint >> 8) & 255;
            const b = bigint & 255;
            return [r, g, b];
        }

        function hexToNormalizedRgb(hex) {
            const [r, g, b] = hexToRgbArray(hex);
            return [(r / 255.0).toFixed(4), (g / 255.0).toFixed(4), (b / 255.0).toFixed(4)];
        }

        // --- –õ–æ–≥—ñ–∫–∞ –û–Ω–æ–≤–ª–µ–Ω–Ω—è ---
        
        function openTab(evt, tabName) {
            const tabcontent = document.getElementsByClassName("tab-content");
            for (const content of tabcontent) {
                content.style.display = "none";
            }
            const tablinks = document.getElementsByClassName("tab-button");
            for (const link of tablinks) {
                link.classList.remove("active");
            }
            document.getElementById(tabName).style.display = "flex"; 
            evt.currentTarget.classList.add("active");
        }

        function updateSettings() {
            // –û—á–∏—â–µ–Ω–Ω—è –æ–±'—î–∫—Ç—ñ–≤ –¥–ª—è —á–∏—Å—Ç–æ—Ç–∏
            currentSettings.water = {};
            currentSettings.lighting = {};
            currentSettings.fog = {};
            currentSettings.animation = {};
            currentSettings.features = {}; 

            // –ó—á–∏—Ç—É–≤–∞–Ω–Ω—è —Ç–∞ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –≤—Å—ñ—Ö –∑–Ω–∞—á–µ–Ω—å
            for (const id in UI_MAP) {
                const element = document.getElementById(id);
                if (!element) continue;

                let value;
                const isCheckbox = element.type === 'checkbox';

                if (isCheckbox) {
                    value = element.checked;
                } else {
                    value = element.value;
                }

                // –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è –≤ –≥–ª–æ–±–∞–ª—å–Ω–∏–π –æ–±'—î–∫—Ç (–Ü–ù–Ü–¶–Ü–ê–õ–Ü–ó–ê–¶–Ü–Ø)
                const finalKey = id.replace(/-/g, '');

                if (isCheckbox) {
                    currentSettings.features[finalKey] = value;
                } else if (id.includes('water')) {
                    currentSettings.water[finalKey] = value;
                } else if (id.includes('ripple') || id.includes('sway') || id.includes('cloud')) {
                    currentSettings.animation[finalKey] = value;
                } else if (id.includes('pbr') || id.includes('sunlight') || id.includes('moonlight') || id.includes('light-source')) {
                    currentSettings.lighting[finalKey] = value;
                } else if (id.includes('fog') || id.includes('saturation') || id.includes('sky')) {
                    currentSettings.fog[finalKey] = value;
                }

                // –û–Ω–æ–≤–ª–µ–Ω–Ω—è UI —Å–ø–∞–Ω—ñ–≤
                const spanId = id.replace('-slider', '').replace('-picker', '').replace('enable-', '') + '-value';
                const span = document.getElementById(spanId);

                if (span && !isCheckbox) {
                    const valueText = (id === 'water-realism-slider') ? '–†—ñ–≤–µ–Ω—å ' + value : UI_MAP[id].replace('{value}', value);
                    span.textContent = valueText;
                }
            }
        }
        
        // --- –õ–æ–≥—ñ–∫–∞ –ì–µ–Ω–µ—Ä–∞—Ü—ñ—ó JSON ---

        function createWaterConfigJson(w, a, f) {
            const swayAmplitude = f.enableswayanimation ? parseFloat(a.leavesswayamp) : 0.0;
            
            return JSON.stringify({
                "water_config": {
                    "u_water_realism_level": f.enablewaterreflection ? parseInt(w.waterrealism) : 0, 
                    "u_water_depth": parseFloat(w.waterdepth),
                    "u_ripple_amplitude": f.enableswayanimation ? parseFloat(a.rippleintensity) : 0.0,
                    
                    "u_grass_sway_speed": f.enableswayanimation ? parseFloat(a.grassswayspeed) : 0.0, 
                    "u_leaves_sway_amplitude": swayAmplitude,
                    "u_cloud_speed": parseFloat(a.cloudspeed), 

                    "u_enable_reflection": f.enablewaterreflection, 
                }
            }, null, 4);
        }

        function createLightingConfigJson(settings, f) {
            const godRayIntensity = f.enablegodrays ? 0.5 : 0.0; 

            return JSON.stringify({
                "lighting_config": {
                    "u_sun_intensity": parseFloat(settings.sunlightintensity),
                    "u_moon_intensity": parseFloat(settings.moonlightintensity),
                    "u_light_source_radius": parseFloat(settings.lightsourceradius),

                    "u_pbr_reflectivity": f.enablepbr ? parseFloat(settings.pbrreflectivity) : 0.0,
                    "u_god_ray_intensity": godRayIntensity,
                }
            }, null, 4);
        }

        function createFogConfigJson(settings) {
            const fogRgb = hexToNormalizedRgb(settings.fogcolor);
            const skyRgb = hexToNormalizedRgb(settings.skycolor);
            return JSON.stringify({
                "fog_config": {
                    "u_fog_density": parseFloat(settings.fogdensity),
                    "u_fog_color_rgb": fogRgb,
                    "u_sky_color_rgb": skyRgb,
                    "u_global_saturation": parseFloat(settings.saturation)
                }
            }, null, 4);
        }

        function createMasterManifest(headerUUID, moduleUUID) {
             return JSON.stringify({
                "format_version": 2,
                "header": {
                    "name": "Master Shader Pack (v7 Mobile)",
                    "description": "–û–±'—î–¥–Ω–∞–Ω–∏–π –ø–∞–∫–µ—Ç –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ–π —à–µ–π–¥–µ—Ä—ñ–≤. –ê–¥–∞–ø—Ç–æ–≤–∞–Ω–∏–π –¥–ª—è –º–æ–±—ñ–ª—å–Ω–∏—Ö –ø—Ä–∏—Å—Ç—Ä–æ—ó–≤.",
                    "uuid": headerUUID,
                    "version": [1, 0, 0],
                    "min_engine_version": [1, 19, 0]
                },
                "modules": [
                    {"type": "resources", "uuid": moduleUUID, "version": [1, 0, 0]}
                ]
            }, null, 4);
        }

        // --- –û–±'—î–¥–Ω–∞–Ω–Ω—è —Ç–∞ –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è ---

        async function combineAndDownloadPack() {
            document.getElementById('status-message').style.color = 'orange';
            document.getElementById('status-message').textContent = '–ì–µ–Ω–µ—Ä–∞—Ü—ñ—è —Ñ–∞–π–ª—É .mcpack...';

            // –ì–∞—Ä–∞–Ω—Ç—É—î–º–æ, —â–æ –≤—Å—ñ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –∑—á–∏—Ç–∞–Ω—ñ
            updateSettings();

            const zip = new JSZip();
            const headerUUID = generateUUID();
            const moduleUUID = generateUUID();

            // 1. –°—Ç–≤–æ—Ä–µ–Ω–Ω—è JSON-—Ñ–∞–π–ª—ñ–≤
            const waterConfig = createWaterConfigJson(currentSettings.water, currentSettings.animation, currentSettings.features);
            const lightingConfig = createLightingConfigJson(currentSettings.lighting, currentSettings.features);
            const fogConfig = createFogConfigJson(currentSettings.fog); 

            // 2. –î–æ–¥–∞–≤–∞–Ω–Ω—è Master Manifest —Ç–∞ JSON-—Ñ–∞–π–ª—ñ–≤ —É ZIP
            zip.file("manifest.json", createMasterManifest(headerUUID, moduleUUID));
            zip.file("shader_configs/water_config.json", waterConfig);
            zip.file("shader_configs/lighting_config.json", lightingConfig);
            zip.file("shader_configs/fog_config.json", fogConfig);

            // 3. –°—Ç–∏—Å–Ω–µ–Ω–Ω—è —Ç–∞ –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è
            try {
                const content = await zip.generateAsync({type: "blob"});
                
                // *** –ö–õ–Æ–ß–û–í–ï –í–ò–ü–†–ê–í–õ–ï–ù–ù–Ø –î–õ–Ø MCPACK ***
                saveAs(content, "master_shader_pack_v7.mcpack"); 

                document.getElementById('status-message').style.color = 'var(--mc-green)';
                document.getElementById('status-message').textContent = '‚úÖ Master Pack v7 —É—Å–ø—ñ—à–Ω–æ –∑–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω–æ —Ç–∞ –∑–±–µ—Ä–µ–∂–µ–Ω–æ —è–∫ .mcpack!';
            } catch (error) {
                document.getElementById('status-message').style.color = 'red';
                document.getElementById('status-message').textContent = `‚ùå –ü–æ–º–∏–ª–∫–∞: ${error.message}`;
                console.error(error);
            }
        }

        // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è —Å–∞–π—Ç—É
        window.onload = () => {
            updateSettings(); 
            openTab({currentTarget: document.querySelector('.tab-button')}, 'water'); 
        };
    </script>
</body>
</html>